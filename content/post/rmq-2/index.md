---
title: MQ在设计功能时候应该考虑什么？
description: RocketMQ的学习记录
slug: rmq-design
date: 2023-06-20 14:28:00+0000
categories:
    - 消息队列
tags:
    - RocketMQ
---

# MQ在设计功能时候应该考虑什么？

## 前言
> *No Silver Bullet—Essence and Accidents of Software Engineering*

没有银弹，指的是不存在万能的，解决所有问题的方案。在设计一个方案时候，需要对功能、能力的优先级进行区分，优先保证最重要的能力。

## MQ的能力优先级
### 1.生产者发送消息正常
MQ核心能力之一就是削峰填谷，如果生产者的消息发送不正常，那么显然违背了使用MQ的初衷，当然为了保护整个MQ系统的可用性，有时限流生产者的行为是可以接受的。
### 2.消息持久化不丢失
消息持久化后丢失或者没有成功持久化，带来的结果是消息的丢失，通常需要结合业务日志做排查才能将这部分丢失数据重新找回，甚至可能就是无法找回带来实实在在的损失。
### 3.消息消费不丢失
这里的消费不丢失是指的消费位点没有被跳过，每一条消息都被消费者成功消费至少一次，如果出现消费丢失情况，且没有能够及时发现会对业务造成影响。
### 4.顺序消息的顺序性
顺序消息的顺序性通常是为了保证业务的正常执行，如果顺序打乱通常会造成业务执行的阻塞，但是通常容易发现，容易解决。
### 5.消息低延迟
MQ的延迟不是优先考虑的因素，如果需要超级低延迟，通常使用RPC调用方式，但是MQ通常也需要把延迟压到ms级
### 6.消息不重复
为了能够保证1-4，消息不重复通常是最容易被放弃的能力，也是大部分的MQ都要求下游消费者做好幂等的原因。
### 7.消息可观测
